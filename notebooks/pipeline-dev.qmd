---
title: "Pipeline-Dev"
editor: visual
author: "Joe Boktor"
date: '2023-01-24'
format: 
  html:
    page-layout: full
    toc: true
    toc-location: left
    toc-depth: 3
    self-contained: true
    code-fold: true
    code-tools: true
    fig-align: center
---

```{r}
library(reticulate)
library(tidyverse)
library(magrittr)
library(batchtools)
library(listenv)
library(glue)
wkdir <- "/central/groups/MazmanianLab/joeB/Microbiota-Immunomodulation/Microbiota-Immunomodulation"
src_dir <- glue("{wkdir}/notebooks")
reticulate::use_condaenv(condaenv = 'pdmbsR',  required = TRUE)

```

# Selecting Proteins of Interest

The current literature on anti-inflammatory cytokines primarily highlight the following: IL-4, IL-6, IL-10, IL-11, and IL-13 https://www.sciencedirect.com/science/article/abs/pii/S0012369215328208?via%3Dihub

```{r, eval = FALSE}
gget <- import("gget")
proteins_of_interest <- c("interleukin", "interferons", "TGFB", "TNFA")
keyname_search <- gget$search(proteins_of_interest, "homo_sapiens")
keyname_hits <- keyname_search %>% filter(biotype == "protein_coding") %>% 
  filter(gene_name %in% c("IL1RN", "IL4", "IL6", "IL10", "IL11", "IL13"))

# collect amino acid sequences for each protein using the ensembl_id
gget_seq <- function(ensembl_id,  amino_acid=TRUE){
    seq_results <- gget$seq(ensembl_id, translate = amino_acid)
    return(seq_results[2])
}
keyname_hits %<>% mutate(sequences_aa =  map_chr(ensembl_id, gget_seq))
keyname_hits

saveRDS(keyname_hits, glue("{wkdir}/data/interim/tmp/{Sys.Date()}_gget_proteins-of-interest.rds"))

```

```{r}
keyname_hits <- readRDS(glue("{wkdir}/data/interim/tmp/2023-01-27_gget_proteins-of-interest.rds"))
keyname_hits %>% glimpse()
```

```{r}

# module load blast/2.9.0
# cd /central/groups/MazmanianLab/joeB/Downloads/blastdb

# makeblastdb -in /central/groups/MazmanianLab/joeB/Downloads/human-gut/v1.0/uhgp_catalogue/uhgp-95/uhgp-95.faa \
# -out 'ughp95_v1_blastdb' \
# -dbtype 'prot' \
# -parse_seqids \
# -blastdb_version 5 \
# -title 'ughp95_v1' \
# -logfile 'ughp95_v1_blastdb.log'


.cluster_runs
data
.empty
.Rproj.user
.vscode
```

# Sequence Similarity Screen (BLAST)

Needleman Wunsch algorithm (LaTex) using a BLOSUM62 substitution matrix and affine gap penalties.

$$
D(i,j) = \max\left\{ 
  \begin{array}{ll}
    D(i-1, j-1) + s(x_i, y_j)\\ 
    D(i-1, j) + g \\
    D(i, j-1) + g \\
  \end{array}
\right.$
$$

We will select the human proteins of interest and conduct direct BLAST searches against a microbial database. First, we will need to build a blast reference databae

```{python}

import enabrowsertools

```

# Sequence Similarity Screen (BLAST)
